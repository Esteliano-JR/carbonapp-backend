generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["carbon_schema"]
}

model User {
  id            Int            @id @default(autoincrement())
  name          String
  email         String         @unique
  createdAt     DateTime       @default(now())
  cep           String
  cidade        String
  complemento   String?
  cpf           String         @unique
  rua           String
  pontos        Int            @default(0)
  agendamentos  Agendamento[]
  auth          Auth?
  logAtividades LogAtividade[]
  resgates      Resgate[]
  usuarioAcoes  UsuarioAcao[]

  @@schema("carbon_schema")
}

model Acao {
  id        Int           @id @default(autoincrement())
  descricao String
  pontos    Int
  usuarios  UsuarioAcao[]

  @@schema("carbon_schema")
}

model UsuarioAcao {
  id        Int      @id @default(autoincrement())
  usuarioId Int
  acaoId    Int
  createdAt DateTime @default(now())
  acao      Acao     @relation(fields: [acaoId], references: [id])
  usuario   User     @relation(fields: [usuarioId], references: [id])

  @@schema("carbon_schema")
}

model Auth {
  id       Int    @id @default(autoincrement())
  userId   Int    @unique
  password String
  user     User   @relation(fields: [userId], references: [id])

  @@schema("carbon_schema")
}

model Recompensa {
  id          Int       @id @default(autoincrement())
  titulo      String
  descricao   String
  custoPontos Int
  createdAt   DateTime  @default(now())
  resgates    Resgate[]

  @@schema("carbon_schema")
}

model Resgate {
  id           Int        @id @default(autoincrement())
  usuarioId    Int
  recompensaId Int
  createdAt    DateTime   @default(now())
  recompensa   Recompensa @relation(fields: [recompensaId], references: [id])
  usuario      User       @relation(fields: [usuarioId], references: [id])

  @@schema("carbon_schema")
}

model LogAtividade {
  id        Int      @id @default(autoincrement())
  usuarioId Int
  tipo      String
  detalhes  String?
  createdAt DateTime @default(now())
  usuario   User     @relation(fields: [usuarioId], references: [id])

  @@schema("carbon_schema")
}

model Parceiro {
  id           Int           @id @default(autoincrement())
  nome         String
  email        String        @unique
  telefone     String
  cidade       String
  estado       String
  createdAt    DateTime      @default(now())
  agendamentos Agendamento[]

  @@schema("carbon_schema")
}

model Material {
  id           Int                   @id @default(autoincrement())
  nome         String
  agendamentos AgendamentoMaterial[]

  @@schema("carbon_schema")
}

model Agendamento {
  id           Int                   @id @default(autoincrement())
  usuarioId    Int
  parceiroId   Int?
  nomeCompleto String
  telefone     String
  endereco     String
  data         DateTime
  horario      String
  observacoes  String?
  status       String                @default("PENDENTE")
  createdAt    DateTime              @default(now())
  parceiro     Parceiro?             @relation(fields: [parceiroId], references: [id])
  usuario      User                  @relation(fields: [usuarioId], references: [id])
  materiais    AgendamentoMaterial[]

  @@schema("carbon_schema")
}

model AgendamentoMaterial {
  id            Int         @id @default(autoincrement())
  agendamentoId Int
  materialId    Int
  agendamento   Agendamento @relation(fields: [agendamentoId], references: [id])
  material      Material    @relation(fields: [materialId], references: [id])

  @@schema("carbon_schema")
}
